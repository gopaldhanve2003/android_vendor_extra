From 73acb4ec3759d972ef5d399ad3f356eb48c8c312 Mon Sep 17 00:00:00 2001
From: AdarshGrewal <adarshgrewal@gmail.com>
Date: Tue, 25 Mar 2025 00:56:28 +0530
Subject: [PATCH 28/28] fixup! base: Initial SenseProvider for FaceSense
 service

---
 .../sensors/face/sense/FaceAuthenticationClient.java          | 3 +--
 .../sensors/face/sense/FaceInternalCleanupClient.java         | 4 ++--
 .../biometrics/sensors/face/sense/FaceRemovalClient.java      | 4 ++--
 .../server/biometrics/sensors/face/sense/SenseProvider.java   | 4 ++--
 4 files changed, 7 insertions(+), 8 deletions(-)

diff --git a/services/core/java/com/android/server/biometrics/sensors/face/sense/FaceAuthenticationClient.java b/services/core/java/com/android/server/biometrics/sensors/face/sense/FaceAuthenticationClient.java
index 2e2039ced280..2500414c2a81 100644
--- a/services/core/java/com/android/server/biometrics/sensors/face/sense/FaceAuthenticationClient.java
+++ b/services/core/java/com/android/server/biometrics/sensors/face/sense/FaceAuthenticationClient.java
@@ -153,8 +153,7 @@ class FaceAuthenticationClient
         mCallback.onClientFinished(this, true /* success */);
     }
 
-    @Override
-    public @LockoutTracker.LockoutMode int handleFailedAttempt(int userId) {
+    private @LockoutTracker.LockoutMode int handleFailedAttempt(int userId) {
         @LockoutTracker.LockoutMode final int lockoutMode =
                 getLockoutTracker().getLockoutModeForUser(userId);
         final PerformanceTracker performanceTracker =
diff --git a/services/core/java/com/android/server/biometrics/sensors/face/sense/FaceInternalCleanupClient.java b/services/core/java/com/android/server/biometrics/sensors/face/sense/FaceInternalCleanupClient.java
index c2b21f55a64b..d1537ffeea4d 100644
--- a/services/core/java/com/android/server/biometrics/sensors/face/sense/FaceInternalCleanupClient.java
+++ b/services/core/java/com/android/server/biometrics/sensors/face/sense/FaceInternalCleanupClient.java
@@ -61,12 +61,12 @@ class FaceInternalCleanupClient extends InternalCleanupClient<Face, ISenseServic
             Supplier<ISenseService> lazyDaemon, IBinder token,
             int biometricId, int userId, String owner, BiometricUtils<Face> utils, int sensorId,
             @NonNull BiometricLogger logger, @NonNull BiometricContext biometricContext,
-            Map<Integer, Long> authenticatorIds) {
+            Map<Integer, Long> authenticatorIds, int reason) {
         // Internal remove does not need to send results to anyone. Cleanup (enumerate + remove)
         // is all done internally.
         return new FaceRemovalClient(context, lazyDaemon, token,
                 null /* ClientMonitorCallbackConverter */, biometricId, userId, owner, utils,
-                sensorId, logger, biometricContext, authenticatorIds);
+                sensorId, logger, biometricContext, authenticatorIds, reason);
     }
 
     @Override
diff --git a/services/core/java/com/android/server/biometrics/sensors/face/sense/FaceRemovalClient.java b/services/core/java/com/android/server/biometrics/sensors/face/sense/FaceRemovalClient.java
index 93e72863fac8..54494cb90a6e 100644
--- a/services/core/java/com/android/server/biometrics/sensors/face/sense/FaceRemovalClient.java
+++ b/services/core/java/com/android/server/biometrics/sensors/face/sense/FaceRemovalClient.java
@@ -45,9 +45,9 @@ class FaceRemovalClient extends RemovalClient<Face, ISenseService> {
             int biometricId, int userId, @NonNull String owner, @NonNull BiometricUtils<Face> utils,
             int sensorId, @NonNull BiometricLogger logger,
             @NonNull BiometricContext biometricContext,
-            @NonNull Map<Integer, Long> authenticatorIds) {
+            @NonNull Map<Integer, Long> authenticatorIds, int reason) {
         super(context, lazyDaemon, token, listener, userId, owner, utils, sensorId, logger,
-                biometricContext, authenticatorIds);
+                biometricContext, authenticatorIds, reason);
         mBiometricId = biometricId;
     }
 
diff --git a/services/core/java/com/android/server/biometrics/sensors/face/sense/SenseProvider.java b/services/core/java/com/android/server/biometrics/sensors/face/sense/SenseProvider.java
index 6573b9e7e88f..0fe4fb9d26ba 100644
--- a/services/core/java/com/android/server/biometrics/sensors/face/sense/SenseProvider.java
+++ b/services/core/java/com/android/server/biometrics/sensors/face/sense/SenseProvider.java
@@ -702,7 +702,7 @@ public class SenseProvider implements ServiceProvider {
                     FaceUtils.getLegacyInstance(mSensorId), mSensorId,
                     createLogger(BiometricsProtoEnums.ACTION_REMOVE,
                             BiometricsProtoEnums.CLIENT_UNKNOWN),
-                    mBiometricContext, mAuthenticatorIds);
+                    mBiometricContext, mAuthenticatorIds, BiometricsProtoEnums.UNENROLL_REASON_USER_REQUEST);
             mScheduler.scheduleClientMonitor(client, mBiometricStateCallback);
         });
     }
@@ -730,7 +730,7 @@ public class SenseProvider implements ServiceProvider {
                     FaceUtils.getLegacyInstance(mSensorId), mSensorId,
                     createLogger(BiometricsProtoEnums.ACTION_REMOVE,
                             BiometricsProtoEnums.CLIENT_UNKNOWN),
-                    mBiometricContext, mAuthenticatorIds);
+                    mBiometricContext, mAuthenticatorIds, BiometricsProtoEnums.UNENROLL_REASON_USER_REQUEST);
             mScheduler.scheduleClientMonitor(client, mBiometricStateCallback);
         });
     }
-- 
2.49.0

