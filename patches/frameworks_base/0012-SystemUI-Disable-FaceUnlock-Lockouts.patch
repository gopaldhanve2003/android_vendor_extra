From f3143d14416609e0040d4fab6078c60b65b3cb3e Mon Sep 17 00:00:00 2001
From: minaripenguin <minaripenguin@users.noreply.github.com>
Date: Sun, 28 Apr 2024 08:22:52 +0800
Subject: [PATCH 12/28] SystemUI: Disable FaceUnlock Lockouts

Change-Id: I2fb0b88deadc6c3ea78793d514c136c4d134bb6f
Signed-off-by: minaripenguin <minaripenguin@users.noreply.github.com>
Signed-off-by: Dmitrii <bankersenator@gmail.com>
---
 .../repository/DeviceEntryFaceAuthRepository.kt    |  4 ++--
 .../SystemUIDeviceEntryFaceAuthInteractor.kt       | 14 +++-----------
 2 files changed, 5 insertions(+), 13 deletions(-)

diff --git a/packages/SystemUI/src/com/android/systemui/deviceentry/data/repository/DeviceEntryFaceAuthRepository.kt b/packages/SystemUI/src/com/android/systemui/deviceentry/data/repository/DeviceEntryFaceAuthRepository.kt
index 514242b41eb1..bf13582a840b 100644
--- a/packages/SystemUI/src/com/android/systemui/deviceentry/data/repository/DeviceEntryFaceAuthRepository.kt
+++ b/packages/SystemUI/src/com/android/systemui/deviceentry/data/repository/DeviceEntryFaceAuthRepository.kt
@@ -225,7 +225,7 @@ constructor(
         } ?: flowOf(false)
 
     override fun setLockedOut(isLockedOut: Boolean) {
-        _isLockedOut.value = isLockedOut
+        _isLockedOut.value = false
     }
 
     private val faceLockoutResetCallback =
@@ -474,7 +474,7 @@ constructor(
             override fun onAuthenticationError(errorCode: Int, errString: CharSequence?) {
                 val errorStatus = ErrorFaceAuthenticationStatus(errorCode, errString.toString())
                 if (errorStatus.isLockoutError()) {
-                    _isLockedOut.value = true
+                    _isLockedOut.value = false
                 }
                 _isAuthenticated.value = false
                 _authenticationStatus.value = errorStatus
diff --git a/packages/SystemUI/src/com/android/systemui/deviceentry/domain/interactor/SystemUIDeviceEntryFaceAuthInteractor.kt b/packages/SystemUI/src/com/android/systemui/deviceentry/domain/interactor/SystemUIDeviceEntryFaceAuthInteractor.kt
index b19b2d9ece02..c0541f166f76 100644
--- a/packages/SystemUI/src/com/android/systemui/deviceentry/domain/interactor/SystemUIDeviceEntryFaceAuthInteractor.kt
+++ b/packages/SystemUI/src/com/android/systemui/deviceentry/domain/interactor/SystemUIDeviceEntryFaceAuthInteractor.kt
@@ -320,17 +320,9 @@ constructor(
     override val isBypassEnabled: Flow<Boolean> = repository.isBypassEnabled
 
     private fun runFaceAuth(uiEvent: FaceAuthUiEvent, fallbackToDetect: Boolean) {
-        if (repository.isLockedOut.value) {
-            faceAuthenticationStatusOverride.value =
-                ErrorFaceAuthenticationStatus(
-                    BiometricFaceConstants.FACE_ERROR_LOCKOUT_PERMANENT,
-                    context.resources.getString(R.string.keyguard_face_unlock_unavailable),
-                )
-        } else {
-            faceAuthenticationStatusOverride.value = null
-            faceAuthenticationLogger.authRequested(uiEvent)
-            repository.requestAuthenticate(uiEvent, fallbackToDetection = fallbackToDetect)
-        }
+        faceAuthenticationStatusOverride.value = null
+        faceAuthenticationLogger.authRequested(uiEvent)
+        repository.requestAuthenticate(uiEvent, fallbackToDetection = fallbackToDetect)
     }
 
     override fun isFaceAuthEnabledAndEnrolled(): Boolean =
-- 
2.49.0

